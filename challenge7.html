<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Forest CTF Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a0a;
            color: #0f0;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #0f0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            color: #0f0;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
        }
        
        .sidebar {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            height: fit-content;
        }
        
        .main-content {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            min-height: 600px;
        }
        
        .nav-list {
            list-style-type: none;
        }
        
        .nav-list li {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .nav-list li:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: #0f0;
        }
        
        .nav-list a {
            color: #0f0;
            text-decoration: none;
            display: block;
        }
        
        .challenge-info {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .badge {
            display: inline-block;
            background: #ff0;
            color: #000;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .terminal {
            background-color: #111;
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .input-line {
            display: flex;
            margin-bottom: 20px;
        }
        
        .prompt {
            margin-right: 10px;
            color: #0af;
        }
        
        .command-input {
            flex-grow: 1;
            background-color: #111;
            border: 1px solid #0f0;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 5px 10px;
        }
        
        .command {
            color: #0af;
            margin-bottom: 5px;
        }
        
        .output {
            margin-bottom: 15px;
            white-space: pre-wrap;
        }
        
        .error {
            color: #f00;
        }
        
        .success {
            color: #0f0;
            font-weight: bold;
        }
        
        .warning {
            color: #ff0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(0, 30, 0, 0.3);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            color: #0f0;
            margin: 10px 0;
        }
        
        .button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background: #0c0;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .button.secondary {
            background: #0af;
            color: #000;
        }
        
        .button.secondary:hover {
            background: #08c;
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }
        
        .virus-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f00;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            color: #000;
            animation: virusPulse 0.5s infinite;
        }
        
        @keyframes virusPulse {
            0% { background-color: #f00; }
            50% { background-color: #ff0; }
            100% { background-color: #f00; }
        }
        
        .completion-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌲 Cyber Forest CTF Challenge</h1>
            <p>Navigate the dangerous cyber forest to find the hidden flags. Beware of traps!</p>
        </div>
        
        <div class="sidebar">
            <h2>CTF Town Hub</h2>
            <ul class="nav-list">
                <li><a href="#" onclick="showView('challenge')">Cyber Forest Challenge</a></li>
                <li><a href="#" onclick="showView('instructions')">Instructions</a></li>
                <li><a href="#" onclick="showView('leaderboard')">Leaderboard</a></li>
                <li><a href="#" onclick="showView('profile')">Your Profile</a></li>
                <li><a href="#" onclick="returnToTown()">Return to Main Town</a></li>
            </ul>
            
            <div class="stats">
                <div class="stat-card">
                    <div>Flags Found</div>
                    <div class="stat-value" id="flags-found">0</div>
                    <div>out of 3</div>
                </div>
                <div class="stat-card">
                    <div>Time Elapsed</div>
                    <div class="stat-value" id="time-elapsed">00:00</div>
                    <div>minutes</div>
                </div>
            </div>
            
            <button class="button" onclick="submitCompletion()">Submit Completion</button>
            <button class="button secondary" onclick="resetChallenge()">Reset Challenge</button>
        </div>
        
        <div class="main-content">
            <div id="challenge-view">
                <div class="challenge-info">
                    <span class="badge">Difficulty: Medium</span>
                    <span class="badge">Category: Forensics</span>
                    <span class="badge">Points: 250</span>
                </div>
                
                <div class="terminal" id="terminal"></div>
                
                <div class="input-line">
                    <span class="prompt">user@cyberforest:$</span>
                    <input type="text" class="command-input" id="command-input" autofocus>
                </div>
                
                <p>Available commands: <code>ls</code>, <code>cd</code>, <code>cat</code>, <code>file</code>, <code>help</code>, <code>clear</code></p>
            </div>
            
            <div id="instructions-view" style="display: none;">
                <h2>Challenge Instructions</h2>
                <p>Your mission is to explore the cyber forest file system and find three hidden flags:</p>
                <ul>
                    <li>Flag 1: Hidden in plain sight</li>
                    <li>Flag 2: In a document folder</li>
                    <li>Flag 3: In an image's metadata</li>
                </ul>
                
                <h3>Commands:</h3>
                <p><code>ls</code> - List directory contents</p>
                <p><code>cd [directory]</code> - Change directory</p>
                <p><code>cat [file]</code> - Display file contents</p>
                <p><code>file [file]</code> - Determine file type</p>
                <p><code>help</code> - Show available commands</p>
                <p><code>clear</code> - Clear the terminal</p>
                
                <h3>Warnings:</h3>
                <p>Be careful which files you open! Some may contain viruses that will temporarily lock your terminal.</p>
            </div>
            
            <div id="leaderboard-view" style="display: none;">
                <h2>Leaderboard</h2>
                <p>Top performers on this challenge:</p>
                <ol>
                    <li>CyberNinja - 2m 45s</li>
                    <li>CodeBreaker - 3m 12s</li>
                    <li>TerminalWizard - 3m 45s</li>
                    <li>ByteMe - 4m 03s</li>
                    <li>RootAccess - 4m 30s</li>
                </ol>
            </div>
            
            <div id="profile-view" style="display: none;">
                <h2>Your Profile</h2>
                <p>Username: CTFExplorer</p>
                <p>Level: Hacker</p>
                <p>Challenges Completed: 12</p>
                <p>Total Points: 2850</p>
            </div>
            
            <div id="completion-message" class="completion-message" style="display: none;">
                <h2>🎉 Challenge Complete! 🎉</h2>
                <p>You've successfully found all flags in the Cyber Forest!</p>
                <p>Time: <span id="completion-time">00:00</span></p>
                <p>Points earned: 250</p>
                <button class="button" onclick="returnToTown()">Return to Town</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const state = {
            currentPath: "/",
            flagsFound: 0,
            infected: false,
            startTime: new Date(),
            timerInterval: null,
            foundFlags: {
                flag1: false,
                flag2: false,
                flag3: false
            },
            currentView: 'challenge'
        };

        // File system structure
        const fileSystem = {
            "/": ["bin/", "home/", "tmp/", "readme.txt"],
            "/bin/": ["ls", "cat", "virus", "safe_program"],
            "/home/": ["user/", "guest/", "flag.txt"],
            "/home/user/": ["Documents/", "Downloads/", "Pictures/", ".hidden_file"],
            "/home/user/Documents/": ["note.txt", "flag2.txt", "secret.docx"],
            "/home/user/Downloads/": ["malware.exe", "clean_file.zip", "suspicious.rar"],
            "/home/user/Pictures/": ["vacation.jpg", "forest.png", "flag3.png"],
            "/home/guest/": ["welcome.txt"],
            "/tmp/": ["temp1", "temp2", "trash/"]
        };

        // File contents
        const fileContents = {
            "/readme.txt": "Welcome to the Cyber Forest!\nBe careful what files you open...",
            "/home/flag.txt": "CTF{not_the_real_flag}",
            "/home/user/Documents/note.txt": "Remember:\n- Don't open suspicious files\n- Check file types before opening\n- The real flags are well hidden",
            "/home/user/Documents/flag2.txt": "CTF{you_found_the_second_flag}",
            "/home/user/Documents/secret.docx": "This appears to be a Word document, but it's actually empty.",
            "/home/user/Downloads/malware.exe": "VIRUS ACTIVATED! Your system is now compromised!",
            "/home/user/Downloads/clean_file.zip": "This archive contains nothing interesting.",
            "/home/user/Downloads/suspicious.rar": "This archive is password protected.",
            "/home/user/Pictures/vacation.jpg": "A nice picture of the beach. Nothing hidden here.",
            "/home/user/Pictures/forest.png": "A dense digital forest. Look closer...",
            "/home/user/Pictures/flag3.png": "The flag is hidden in this image's metadata: CTF{metadata_master}",
            "/home/guest/welcome.txt": "Guest account - no privileges here.",
            "/home/user/.hidden_file": "CTF{hidden_in_plain_sight}",
            "/bin/virus": "INFECTION! You shouldn't have run this!",
            "/bin/safe_program": "This program does nothing dangerous."
        };

        // File types (for 'file' command)
        const fileTypes = {
            "/readme.txt": "ASCII text",
            "/home/flag.txt": "ASCII text",
            "/home/user/Documents/note.txt": "ASCII text",
            "/home/user/Documents/flag2.txt": "ASCII text",
            "/home/user/Documents/secret.docx": "Microsoft Word 2007+",
            "/home/user/Downloads/malware.exe": "PE32 executable (GUI) Intel 80386",
            "/home/user/Downloads/clean_file.zip": "Zip archive data",
            "/home/user/Downloads/suspicious.rar": "RAR archive data",
            "/home/user/Pictures/vacation.jpg": "JPEG image data",
            "/home/user/Pictures/forest.png": "PNG image data",
            "/home/user/Pictures/flag3.png": "PNG image data",
            "/home/guest/welcome.txt": "ASCII text",
            "/home/user/.hidden_file": "ASCII text",
            "/bin/virus": "ELF 64-bit LSB executable",
            "/bin/safe_program": "ELF 64-bit LSB executable"
        };

        // DOM elements
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const flagsFoundDisplay = document.getElementById('flags-found');
        const timeElapsedDisplay = document.getElementById('time-elapsed');
        const completionTimeDisplay = document.getElementById('completion-time');

        // Initialize the challenge
        function initChallenge() {
            terminal.innerHTML = '';
            printToTerminal('Type "help" for available commands\n\n');
            
            // Start timer
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            state.startTime = new Date();
            state.timerInterval = setInterval(updateTimer, 1000);
            
            // Reset state
            state.currentPath = "/";
            state.flagsFound = 0;
            state.foundFlags = { flag1: false, flag2: false, flag3: false };
            flagsFoundDisplay.textContent = "0";
            
            // Hide completion message
            document.getElementById('completion-message').style.display = 'none';
            document.getElementById('challenge-view').style.display = 'block';
        }

        // Update timer display
        function updateTimer() {
            const now = new Date();
            const diff = Math.floor((now - state.startTime) / 1000);
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;
            timeElapsedDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Command processing
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                commandInput.value = '';
                
                if (command) {
                    printToTerminal(`user@cyberforest:${state.currentPath}$ ${command}`, 'command');
                    processCommand(command);
                }
            }
        });

        function processCommand(command) {
            if (state.infected) {
                printToTerminal('System locked due to infection! Please wait...', 'error');
                return;
            }

            const parts = command.split(' ');
            const cmd = parts[0];
            const args = parts.slice(1);

            switch (cmd) {
                case 'ls':
                    executeLs(args);
                    break;
                case 'cd':
                    executeCd(args);
                    break;
                case 'cat':
                    executeCat(args);
                    break;
                case 'file':
                    executeFile(args);
                    break;
                case 'help':
                    executeHelp();
                    break;
                case 'clear':
                    terminal.innerHTML = '';
                    break;
                default:
                    printToTerminal(`Command not found: ${cmd}`, 'error');
            }
        }

        function executeLs(args) {
            const path = args[0] ? resolvePath(args[0]) : state.currentPath;
            
            if (!fileSystem[path]) {
                printToTerminal(`ls: cannot access '${args[0] || path}': No such file or directory`, 'error');
                return;
            }
            
            printToTerminal(fileSystem[path].join(' '));
        }

        function executeCd(args) {
            if (!args[0]) {
                state.currentPath = "/";
                return;
            }

            let targetPath = resolvePath(args[0]);
            
            // Special case for parent directory
            if (args[0] === '..') {
                if (state.currentPath === '/') {
                    printToTerminal('Already at root directory', 'warning');
                    return;
                }
                
                const parts = state.currentPath.split('/').filter(p => p);
                parts.pop();
                state.currentPath = parts.length ? '/' + parts.join('/') + '/' : '/';
                return;
            }
            
            // Check if directory exists
            if (!fileSystem[targetPath] && !fileSystem[targetPath + '/']) {
                printToTerminal(`cd: no such file or directory: ${args[0]}`, 'error');
                return;
            }
            
            // Add trailing slash if needed
            if (!targetPath.endsWith('/')) {
                targetPath += '/';
            }
            
            state.currentPath = targetPath;
        }

        function executeCat(args) {
            if (!args[0]) {
                printToTerminal('Usage: cat FILE', 'error');
                return;
            }

            const filePath = resolvePath(args[0]);
            
            if (filePath in fileContents) {
                const content = fileContents[filePath];
                printToTerminal(content);
                
                // Check for flags
                checkForFlags(content);
                
                // Check for viruses
                if (filePath === '/bin/virus' || filePath === '/home/user/Downloads/malware.exe') {
                    triggerVirus();
                }
            } else {
                printToTerminal(`cat: ${args[0]}: No such file or directory`, 'error');
            }
        }

        function executeFile(args) {
            if (!args[0]) {
                printToTerminal('Usage: file FILE', 'error');
                return;
            }

            const filePath = resolvePath(args[0]);
            
            if (filePath in fileTypes) {
                printToTerminal(`${args[0]}: ${fileTypes[filePath]}`);
            } else {
                printToTerminal(`file: ${args[0]}: No such file or directory`, 'error');
            }
        }

        function executeHelp() {
            const helpText = `Available commands:
ls [DIR]    - List directory contents
cd [DIR]    - Change directory
cat FILE    - Display file contents
file FILE   - Determine file type
help        - Display this help
clear       - Clear the terminal

Flags:
There are 3 hidden flags in the system. Find them all!
`;
            printToTerminal(helpText);
        }

        function resolvePath(path) {
            if (path.startsWith('/')) {
                return path;
            }
            
            return state.currentPath + path;
        }

        function checkForFlags(content) {
            const flags = [
                'CTF{hidden_in_plain_sight}',
                'CTF{you_found_the_second_flag}',
                'CTF{metadata_master}'
            ];
            
            flags.forEach((flag, index) => {
                if (content.includes(flag) && !state.foundFlags[`flag${index + 1}`]) {
                    state.foundFlags[`flag${index + 1}`] = true;
                    state.flagsFound++;
                    flagsFoundDisplay.textContent = state.flagsFound;
                    printToTerminal(`\nCongratulations! You found flag ${index + 1}: ${flag}`, 'success');
                    
                    if (state.flagsFound === 3) {
                        completeChallenge();
                    }
                }
            });
        }

        function triggerVirus() {
            state.infected = true;
            
            // Create virus effect
            const virusDiv = document.createElement('div');
            virusDiv.className = 'virus-effect';
            virusDiv.textContent = '☠️ VIRUS DETECTED! SYSTEM COMPROMISED! ☠️';
            document.body.appendChild(virusDiv);
            
            // Disable input
            commandInput.disabled = true;
            
            // Remove virus after timeout
            setTimeout(() => {
                document.body.removeChild(virusDiv);
                state.infected = false;
                commandInput.disabled = false;
                commandInput.focus();
                printToTerminal('System restored. Be more careful next time!', 'warning');
            }, 5000);
        }

        function completeChallenge() {
            clearInterval(state.timerInterval);
            const now = new Date();
            const timeTaken = Math.floor((now - state.startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            completionTimeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('challenge-view').style.display = 'none';
            document.getElementById('completion-message').style.display = 'block';
            
            // Save completion to localStorage
            const completions = JSON.parse(localStorage.getItem('ctfCompletions') || '{}');
            completions['cyber-forest'] = {
                completed: true,
                time: timeTaken,
                flags: 3,
                date: new Date().toISOString()
            };
            localStorage.setItem('ctfCompletions', JSON.stringify(completions));
        }

        function printToTerminal(text, className = '') {
            const div = document.createElement('div');
            div.className = `output ${className}`;
            div.textContent = text;
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function showView(viewName) {
            // Hide all views
            document.getElementById('challenge-view').style.display = 'none';
            document.getElementById('instructions-view').style.display = 'none';
            document.getElementById('leaderboard-view').style.display = 'none';
            document.getElementById('profile-view').style.display = 'none';
            document.getElementById('completion-message').style.display = 'none';
            
            // Show selected view
            document.getElementById(`${viewName}-view`).style.display = 'block';
            state.currentView = viewName;
        }
        
        function submitCompletion() {
            if (state.flagsFound === 3) {
                alert("Challenge already completed! Well done!");
            } else {
                alert(`You've found ${state.flagsFound} out of 3 flags. Keep searching!`);
            }
        }
        
        function resetChallenge() {
            if (confirm("Are you sure you want to reset the challenge? Your progress will be lost.")) {
                initChallenge();
            }
        }
        
        function returnToTown() {
            // In a real implementation, this would redirect to your town page
            alert("Returning to CTF Town...");
            // window.location.href = "ctf-town.html";
        }

        // Initialize the challenge when page loads
        window.onload = initChallenge;
    </script>
</body>
</html>
