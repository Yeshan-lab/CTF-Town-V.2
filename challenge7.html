<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVEL 7: Reverse Engineering Madness</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7e3ff2;
            --secondary: #00d4ff;
            --accent: #ff9d3d;
            --dark: #0a0a1a;
            --darker: #050510;
            --success: #00ff91;
            --warning: #ffcc00;
            --danger: #ff2a6d;
            --info: #0051ff;
            --terminal-bg: #0a1429;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fira Code', monospace;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap');
        
        body {
            background-color: var(--dark);
            color: #d1d1e8;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(126, 63, 242, 0.05) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(0, 212, 255, 0.05) 0%, transparent 25%),
                linear-gradient(to bottom, rgba(10, 10, 26, 0.9), rgba(5, 5, 16, 0.9)),
                url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3C/g%3E%3C/svg%3E");
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
            grid-template-areas:
                "header header"
                "main side"
                "tools tools"
                "footer footer";
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "header"
                    "main"
                    "side"
                    "tools"
                    "footer";
            }
        }
        
        header {
            grid-area: header;
            text-align: center;
            padding: 30px 0;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--primary);
            border-radius: 8px;
            background: rgba(20, 10, 30, 0.7);
            box-shadow: 0 0 30px rgba(126, 63, 242, 0.4);
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, rgba(126, 63, 242, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        h1 {
            font-size: 3.5rem;
            text-shadow: 0 0 15px var(--primary), 0 0 25px var(--primary);
            margin-bottom: 15px;
            letter-spacing: 4px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
        }
        
        .subtitle {
            color: var(--secondary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .card {
            background: rgba(15, 10, 25, 0.8);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(126, 63, 242, 0.3);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, rgba(126, 63, 242, 0.05) 0%, transparent 70%);
            z-index: -1;
        }
        
        .card h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .card h2 i {
            font-size: 1.8rem;
        }
        
        .tools-panel {
            grid-area: tools;
        }
        
        .main-panel {
            grid-area: main;
        }
        
        .side-panel {
            grid-area: side;
        }
        
        .footer {
            grid-area: footer;
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            border-top: 1px solid var(--primary);
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .terminal {
            background: var(--terminal-bg);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            height: 500px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
        }
        
        .terminal-line {
            margin-bottom: 5px;
            white-space: pre-wrap;
        }
        
        .prompt {
            color: var(--success);
        }
        
        .command {
            color: var(--secondary);
        }
        
        .output {
            color: #cccccc;
        }
        
        .success {
            color: var(--success);
            font-weight: bold;
        }
        
        .error {
            color: var(--danger);
        }
        
        .important {
            color: var(--warning);
            font-weight: bold;
        }
        
        .flag {
            color: var(--warning);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
        }
        
        .input-area {
            display: flex;
            margin-top: 15px;
        }
        
        #command-input {
            flex-grow: 1;
            background: rgba(10, 15, 30, 0.8);
            border: 1px solid var(--primary);
            color: var(--success);
            padding: 12px 15px;
            font-family: 'Fira Code', monospace;
            font-size: 16px;
            border-radius: 4px 0 0 4px;
        }
        
        #execute-btn {
            background: linear-gradient(to bottom, var(--primary), #5a1fc9);
            color: white;
            border: 1px solid var(--primary);
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 0 4px 4px 0;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        #execute-btn:hover {
            background: linear-gradient(to bottom, #8e55ff, var(--primary));
            box-shadow: 0 0 15px rgba(126, 63, 242, 0.7);
        }
        
        .progress {
            margin-top: 20px;
            background: rgba(15, 10, 25, 0.8);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--primary);
        }
        
        .progress-bar-container {
            height: 30px;
            background: rgba(10, 5, 20, 0.8);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--secondary);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 15px;
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            z-index: 1;
            background-size: 50px 50px;
            animation: move 2s linear infinite;
            overflow: hidden;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 15px;
            color: var(--secondary);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .toolbox {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .tool {
            background: rgba(20, 15, 35, 0.8);
            border: 1px solid var(--secondary);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
        }
        
        .tool:hover {
            background: rgba(30, 20, 50, 0.8);
            box-shadow: 0 0 15px var(--secondary);
            transform: translateY(-3px);
        }
        
        .tool i {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .hex-viewer {
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            background: rgba(10, 5, 20, 0.8);
            font-family: 'Fira Code', monospace;
            white-space: pre;
            margin-bottom: 20px;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .hex-address {
            color: var(--accent);
        }
        
        .hex-data {
            color: var(--secondary);
        }
        
        .hex-ascii {
            color: var(--success);
        }
        
        .assembly-view {
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            background: rgba(10, 5, 20, 0.8);
            font-family: 'Fira Code', monospace;
            white-space: pre;
            margin-bottom: 20px;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .assembly-address {
            color: var(--accent);
        }
        
        .assembly-opcode {
            color: var(--secondary);
        }
        
        .assembly-operands {
            color: var(--success);
        }
        
        .assembly-comment {
            color: #666;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--primary);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 8px;
            background: rgba(20, 15, 35, 0.5);
            font-weight: 600;
        }
        
        .tab.active {
            background: rgba(30, 20, 50, 0.8);
            border-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .file-system {
            height: 250px;
            overflow-y: auto;
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            background: rgba(10, 5, 20, 0.8);
            margin-bottom: 20px;
        }
        
        .file-item {
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(126, 63, 242, 0.3);
        }
        
        .file-item:hover {
            background: rgba(30, 20, 50, 0.5);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            background: rgba(20, 15, 35, 0.95);
            border: 1px solid var(--primary);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(126, 63, 242, 0.4);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .countdown {
            font-size: 1.5rem;
            color: var(--danger);
            text-align: center;
            margin: 20px 0;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(255, 42, 109, 0.7);
        }
        
        .submit-section {
            margin-top: 30px;
            text-align: center;
            padding: 30px;
            background: rgba(20, 15, 35, 0.8);
            border: 1px solid var(--primary);
            border-radius: 8px;
            grid-column: 1 / -1;
        }
        
        .submit-button {
            background: linear-gradient(to bottom, var(--success), #00cc73);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 10px;
            border-radius: 6px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .submit-button:hover {
            box-shadow: 0 0 20px var(--success);
            transform: translateY(-3px);
        }
        
        .return-button {
            background: linear-gradient(to bottom, var(--info), #0040cc);
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 10px;
            border-radius: 6px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .return-button:hover {
            box-shadow: 0 0 20px var(--info);
            transform: translateY(-3px);
        }
        
        .completion-message {
            color: var(--success);
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .memory-map {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .memory-region {
            background: rgba(25, 20, 40, 0.8);
            border: 2px solid var(--secondary);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .memory-region:hover {
            background: rgba(35, 25, 55, 0.8);
            box-shadow: 0 0 15px var(--secondary);
            transform: translateY(-3px);
        }
        
        .memory-region.scanned {
            border-color: var(--success);
            background: rgba(20, 40, 25, 0.8);
        }
        
        .memory-region.locked {
            border-color: var(--danger);
            background: rgba(40, 20, 25, 0.8);
            cursor: not-allowed;
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }
        
        .scan-line {
            position: absolute;
            height: 2px;
            width: 100%;
            background: linear-gradient(to right, transparent, var(--secondary), transparent);
            top: 0;
            animation: scan 3s linear infinite;
            z-index: 1;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .disassembly-note {
            color: var(--accent);
            font-style: italic;
            margin-top: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LEVEL 7: REVERSE ENGINEERING MADNESS</h1>
            <p class="subtitle">Analyze the Embedded System Firmware to Uncover Secrets</p>
            <div class="scan-line"></div>
            <div class="countdown" id="countdown">TIME: 59:59</div>
        </header>
        
        <div class="card main-panel">
            <h2><i class="fas fa-microchip"></i> Embedded System Analysis</h2>
            <p>Reverse engineer the firmware image to uncover hidden flags and vulnerabilities.</p>
            
            <div class="terminal" id="terminal">
                <div class="terminal-line">
                    <span class="prompt">re@embedded-system:~$</span>
                    <span class="output">Initializing Reverse Engineering Environment</span>
                </div>
                <div class="terminal-line">
                    <span class="prompt">re@embedded-system:~$</span>
                    <span class="output">Loading tools: binwalk, hexdump, strings, objdump, dd</span>
                </div>
                <div class="terminal-line">
                    <span class="prompt">re@embedded-system:~$</span>
                    <span class="output">Target: firmware.img (Custom ARM architecture, heavily obfuscated)</span>
                </div>
                <div class="terminal-line">
                    <span class="prompt">re@embedded-system:~$</span>
                    <span class="output">Type 'help' for available commands</span>
                </div>
                <div class="terminal-line">
                    <span class="prompt">re@embedded-system:~$</span>
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="command-input" placeholder="Type command here..." autofocus>
                <button id="execute-btn" onclick="executeCommand()">EXECUTE</button>
            </div>
            
            <div class="progress">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="progress-text" id="progress-text">Analysis Progress: 0%</div>
            </div>
        </div>
        
        <div class="card side-panel">
            <h2><i class="fas fa-file-alt"></i> File System</h2>
            
            <div class="file-system">
                <div class="file-item" onclick="selectFile('firmware.img')">
                    <i class="fas fa-file-code"></i>
                    <span>firmware.img (15.7MB) - Target firmware image</span>
                </div>
                <div class="file-item" onclick="selectFile('extracted')">
                    <i class="fas fa-folder"></i>
                    <span>extracted/ - Binwalk extraction output</span>
                </div>
                <div class="file-item" onclick="selectFile('part1.bin')">
                    <i class="fas fa-file"></i>
                    <span>part1.bin - Extracted binary section</span>
                </div>
                <div class="file-item" onclick="selectFile('squashfs-root')">
                    <i class="fas fa-folder"></i>
                    <span>squashfs-root/ - Extracted filesystem</span>
                </div>
                <div class="file-item" onclick="selectFile('bootloader.bin')">
                    <i class="fas fa-file"></i>
                    <span>bootloader.bin - Bootloader section</span>
                </div>
            </div>
            
            <h2><i class="fas fa-memory"></i> Memory Map</h2>
            <div class="memory-map">
                <div class="memory-region" onclick="analyzeRegion('bootloader')">
                    <h3>Bootloader</h3>
                    <p>0x000000-0x0FFFFF</p>
                </div>
                <div class="memory-region" onclick="analyzeRegion('kernel')">
                    <h3>Kernel</h3>
                    <p>0x100000-0x2FFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('filesystem')">
                    <h3>Filesystem</h3>
                    <p>0x300000-0x6FFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('config')">
                    <h3>Config</h3>
                    <p>0x700000-0x7FFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('runtime')">
                    <h3>Runtime Data</h3>
                    <p>0x800000-0x9FFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('secure')">
                    <h3>Secure Zone</h3>
                    <p>0xA00000-0xAFFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('hardware')">
                    <h3>Hardware Regs</h3>
                    <p>0xB00000-0xBFFFFF</p>
                </div>
                <div class="memory-region locked" onclick="analyzeRegion('reserved')">
                    <h3>Reserved</h3>
                    <p>0xC00000-0xFFFFFF</p>
                </div>
            </div>
        </div>
        
        <div class="card tools-panel">
            <h2><i class="fas fa-tools"></i> Reverse Engineering Tools</h2>
            
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('analysis-tab')">Static Analysis</div>
                <div class="tab" onclick="switchTab('hex-tab')">Hex Viewer</div>
                <div class="tab" onclick="switchTab('asm-tab')">Disassembly</div>
            </div>
            
            <div id="analysis-tab" class="tab-content active">
                <div class="toolbox">
                    <div class="tool" onclick="executeTool('binwalk')">
                        <i class="fas fa-search"></i>
                        <span>Binwalk</span>
                    </div>
                    <div class="tool" onclick="executeTool('strings')">
                        <i class="fas fa-font"></i>
                        <span>Strings</span>
                    </div>
                    <div class="tool" onclick="executeTool('hexdump')">
                        <i class="fas fa-table"></i>
                        <span>Hexdump</span>
                    </div>
                    <div class="tool" onclick="executeTool('dd')">
                        <i class="fas fa-cut"></i>
                        <span>DD Extract</span>
                    </div>
                </div>
                
                <div class="hex-viewer" id="analysis-output">
                    // Analysis output will appear here
                    // Run binwalk, strings, or other analysis tools
                </div>
            </div>
            
            <div id="hex-tab" class="tab-content">
                <div class="toolbox">
                    <div class="tool" onclick="showHexDump(0x000000, 512)">
                        <i class="fas fa-angle-double-left"></i>
                        <span>Header</span>
                    </div>
                    <div class="tool" onclick="showHexDump(0x0A0000, 512)">
                        <i class="fas fa-unlock"></i>
                        <span>Secure Zone</span>
                    </div>
                    <div class="tool" onclick="showHexDump(0x300000, 512)">
                        <i class="fas fa-folder"></i>
                        <span>Filesystem</span>
                    </div>
                    <div class="tool" onclick="showHexDump(0x7FF000, 512)">
                        <i class="fas fa-cog"></i>
                        <span>Config End</span>
                    </div>
                </div>
                
                <div class="hex-viewer" id="hex-output">
                    // Hex output will appear here
                    // Select a memory region to view
                </div>
            </div>
            
            <div id="asm-tab" class="tab-content">
                <div class="toolbox">
                    <div class="tool" onclick="disassembleRegion(0x001000, 20)">
                        <i class="fas fa-code"></i>
                        <span>Boot Code</span>
                    </div>
                    <div class="tool" onclick="disassembleRegion(0x010000, 20)">
                        <i class="fas fa-bolt"></i>
                        <span>Init Routine</span>
                    </div>
                    <div class="tool" onclick="disassembleRegion(0x100000, 20)">
                        <i class="fas fa-cogs"></i>
                        <span>Kernel Start</span>
                    </div>
                    <div class="tool" onclick="disassembleRegion(0x2ABCD0, 20)">
                        <i class="fas fa-user-secret"></i>
                        <span>Obfuscated Code</span>
                    </div>
                </div>
                
                <div class="assembly-view" id="asm-output">
                    // Disassembly will appear here
                    // Select a code region to disassemble
                </div>
                <div class="disassembly-note">
                    Note: This is a custom ARM architecture with modified opcodes
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>REVERSE ENGINEERING CHALLENGE | LEVEL 7 CTF | EMBEDDED SYSTEM ANALYSIS</p>
            <p>This is a simulation for educational purposes only. All challenges are fictional.</p>
        </div>
        
        <div class="submit-section">
            <p>Found all 5 flags? Submit your success!</p>
            <button class="submit-button" onclick="submitCompletion()">Mission Complete</button>
            <button class="return-button" onclick="returnToTown()">Emergency Exit</button>
            <div id="completion-message" class="completion-message"></div>
        </div>
    </div>

    <div class="notification" id="notification">
        <span id="notification-text"></span>
    </div>

    <script>
        // Initialize variables
        let progress = 0;
        let flagsFound = [];
        let regionsScanned = [];
        let commandHistory = [];
        let historyIndex = -1;
        let currentTab = 'analysis-tab';
        let timeLeft = 59 * 60; // 59 minutes in seconds
        
        // Define all 5 CTF flags
        const allFlags = [
            'CTF{squashfs_hidden_flag}',
            'CTF{jump_opcode_obfuscated}',
            'CTF{xor_b64_reversed}',
            'CTF{dd_extract_hidden_block}',
            'CTF{bootloader_serial_password}'
        ];
        
        // Initialize terminal
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const completionMessage = document.getElementById('completion-message');
        const countdownElement = document.getElementById('countdown');
        const analysisOutput = document.getElementById('analysis-output');
        const hexOutput = document.getElementById('hex-output');
        const asmOutput = document.getElementById('asm-output');
        
        // Add event listener for Enter key
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                executeCommand();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                navigateHistory(-1);
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                navigateHistory(1);
            }
        });
        
        function navigateHistory(direction) {
            if (commandHistory.length === 0) return;
            
            historyIndex += direction;
            
            if (historyIndex < 0) historyIndex = 0;
            if (historyIndex >= commandHistory.length) historyIndex = commandHistory.length - 1;
            
            commandInput.value = commandHistory[historyIndex];
        }
        
        function executeCommand() {
            const command = commandInput.value.trim();
            if (!command) return;
            
            // Add to history
            commandHistory.push(command);
            historyIndex = commandHistory.length;
            
            // Display command
            addTerminalLine(`<span class="prompt">re@embedded-system:~$</span> <span class="command">${command}</span>`);
            
            // Process command
            processCommand(command);
            
            // Clear input
            commandInput.value = '';
            commandInput.focus();
        }
        
        function processCommand(cmd) {
            const command = cmd.toLowerCase();
            
            if (command === 'help') {
                showHelp();
            } else if (command === 'clear') {
                clearTerminal();
            } else if (command === 'exit') {
                addTerminalLine('<span class="output">Exiting reverse engineering environment...</span>');
            } else if (command === 'ls' || command === 'dir') {
                listFiles();
            } else if (command === 'whoami') {
                addTerminalLine('<span class="output">reverse-engineering-specialist</span>');
            } else if (command === 'pwd') {
                addTerminalLine('<span class="output">/home/re/embedded-analysis</span>');
            } else if (command.startsWith('binwalk')) {
                runBinwalk(command);
            } else if (command.startsWith('strings')) {
                runStrings(command);
            } else if (command.startsWith('hexdump')) {
                runHexdump(command);
            } else if (command.startsWith('dd ')) {
                runDD(command);
            } else if (command.startsWith('objdump')) {
                runObjdump(command);
            } else if (command === 'show flags') {
                showFlags();
            } else if (command === 'show progress') {
                showProgress();
            } else if (command === 'status') {
                showStatus();
            } else {
                addTerminalLine(`<span class="error">Command not recognized: ${cmd}. Type 'help' for available commands.</span>`);
            }
        }
        
        function runBinwalk(cmd) {
            addTerminalLine('<span class="output">Scanning firmware for embedded files and structures...</span>');
            
            setTimeout(() => {
                analysisOutput.innerHTML = `DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             uImage header, header size: 64 bytes, header CRC: 0x7CD3A7B6, created: 2023-01-15 04:12:33, image size: 15267234 bytes, Data Address: 0x8000, Entry Point: 0x8000, data CRC: 0xBD124A9, OS: Linux, CPU: ARM, image type: OS Kernel Image, compression type: none, image name: "Linux-4.19.78"
64            0x40            Linux kernel ARM boot executable zImage (little-endian)
18324         0x4794          xz compressed data
20480         0x5000          <span class="important">SQUASHFS filesystem, little endian, version 4.0, compression:lz4, size: 8654023 bytes, 2816 inodes, blocksize: 131072 bytes, created: 2023-01-15 04:12:32</span>
15267298      0xE8F5E2        <span class="important">Certificate in DER format (x509 v3)</span>
15267840      0xE9180         <span class="important">ELF, 32-bit LSB executable, ARM, version 1 (SYSV)</span>
15267872      0xE91A0         <span class="important">PNG image, 64 x 64, 8-bit/color RGBA, non-interlaced</span>
15268016      0xE9230         <span class="important">Zlib compressed data, best compression</span>`;

                addTerminalLine('<span class="output">Binwalk analysis complete. Found multiple embedded files.</span>');
                
                if (!flagsFound.includes('CTF{squashfs_hidden_flag}')) {
                    flagsFound.push('CTF{squashfs_hidden_flag}');
                    addTerminalLine('<span class="important">Flag 1: CTF{squashfs_hidden_flag}</span>');
                    showNotification('SquashFS Filesystem Detected - Flag 1 Found');
                    updateProgress(20);
                }
            }, 2000);
        }
        
        function runStrings(cmd) {
            addTerminalLine('<span class="output">Extracting printable strings from binary data...</span>');
            
            setTimeout(() => {
                analysisOutput.innerHTML = `Strings analysis of firmware.img:

<...truncated...>
0x2ABCD0: "bootloader_secure_start"
0x2ABCEE: "HardwareInit"
0x2ABCFF: "MemoryTest"
0x2ABD0E: "JumpToKernel"
0x2ABD1F: "SerialConsoleEnabled"
0x2ABD38: "Password: "
0x2ABD43: "TawonMafiaSecureBoot2023"
0x2ABD5F: "AuthSuccess"
0x2ABD6B: "AuthFailed"
0x2ABD77: "Welcome to Tawon Mafia Embedded System"
0x2ABDA3: "Enter maintenance mode password: "
0x2ABDC8: "FLAG: RlRGe2p1bXBfb3Bjb2RlX29iZnVzY2F0ZWR9"
0x2ABE00: "Configuring network interface"
0x2ABE22: "Starting services"
0x2ABE38: "Debug mode disabled"
0x2ABE50: "Custom ARM architecture detected"
0x2ABE75: "Obfuscated opcodes active"
0x2ABE92: "Memory protection enabled"
<...truncated...>`;

                addTerminalLine('<span class="output">Strings extraction complete. Found interesting text fragments.</span>');
                
                // Check if they found the encoded flag
                if (cmd.includes("0x2ABDC8") || cmd.includes("-t x")) {
                    if (!flagsFound.includes('CTF{xor_b64_reversed}')) {
                        flagsFound.push('CTF{xor_b64_reversed}');
                        addTerminalLine('<span class="important">Flag 3: CTF{xor_b64_reversed}</span>');
                        showNotification('Base64 XOR String Found - Flag 3 Discovered');
                        updateProgress(20);
                    }
                }
            }, 2000);
        }
        
        function runHexdump(cmd) {
            addTerminalLine('<span class="output">Generating hex dump of binary data...</span>');
            
            setTimeout(() => {
                if (cmd.includes("-C") || cmd.includes("-c")) {
                    hexOutput.innerHTML = `<span class="hex-address">00000000:</span> <span class="hex-data">7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span>  <span class="hex-ascii">.ELF............</span>
<span class="hex-address">00000010:</span> <span class="hex-data">02 00 28 00 01 00 00 00 00 80 00 00 34 00 00 00</span>  <span class="hex-ascii">..(.......4.....</span>
<span class="hex-address">00000020:</span> <span class="hex-data">24 4a 00 00 00 02 00 05 34 00 20 00 08 00 28 00</span>  <span class="hex-ascii">$J......4. ...(.</span>
<span class="hex-address">00000030:</span> <span class="hex-data">1d 00 1a 00 06 00 00 00 34 00 00 00 34 80 00 00</span>  <span class="hex-ascii">........4...4...</span>
<span class="hex-address">00000040:</span> <span class="hex-data">34 80 00 00 a0 01 00 00 a0 01 00 00 05 00 00 00</span>  <span class="hex-ascii">4...............</span>
<span class="hex-address">00000050:</span> <span class="hex-data">04 00 00 00 03 00 00 00 34 01 00 00 34 81 00 00</span>  <span class="hex-ascii">........4...4...</span>
<span class="hex-address">00000060:</span> <span class="hex-data">34 81 00 00 13 00 00 00 13 00 00 00 04 00 00 00</span>  <span class="hex-ascii">4...............</span>
<span class="hex-address">00000070:</span> <span class="hex-data">01 00 00 00 01 00 00 00 00 00 00 00 00 80 00 00</span>  <span class="hex-ascii">................</span>
<span class="hex-address">00000080:</span> <span class="hex-data">00 80 00 00 4c 3b 00 00 4c 3b 00 00 07 00 00 00</span>  <span class="hex-ascii">....L;..L;......</span>
<span class="hex-address">00000090:</span> <span class="hex-data">00 10 00 00 01 00 00 00 00 00 00 00 01 00 00 00</span>  <span class="hex-ascii">................</span>`;
                } else {
                    hexOutput.innerHTML = `<span class="hex-address">00000000:</span> <span class="hex-data">7f45 4c46 0101 0100 0000 0000 0000 0000</span>
<span class="hex-address">00000010:</span> <span class="hex-data">0200 2800 0100 0000 0080 0000 3400 0000</span>
<span class="hex-address">00000020:</span> <span class="hex-data">244a 0000 0002 0005 3400 2000 0800 2800</span>
<span class="hex-address">00000030:</span> <span class="hex-data">1d00 1a00 0600 0000 3400 0000 3480 0000</span>
<span class="hex-address">00000040:</span> <span class="hex-data">3480 0000 a001 0000 a001 0000 0500 0000</span>
<span class="hex-address">00000050:</span> <span class="hex-data">0400 0000 0300 0000 3401 0000 3481 0000</span>
<span class="hex-address">00000060:</span> <span class="hex-data">3481 0000 1300 0000 1300 0000 0400 0000</span>
<span class="hex-address">00000070:</span> <span class="hex-data">0100 0000 0100 0000 0000 0000 0080 0000</span>
<span class="hex-address">00000080:</span> <span class="hex-data">0080 0000 4c3b 0000 4c3b 0000 0700 0000</span>
<span class="hex-address">00000090:</span> <span class="hex-data">0010 0000 0100 0000 0000 0000 0100 0000</span>`;
                }
                
                addTerminalLine('<span class="output">Hex dump generated. Viewing binary structure.</span>');
            }, 1500);
        }
        
        function runDD(cmd) {
            addTerminalLine('<span class="output">Extracting binary data with dd...</span>');
            
            setTimeout(() => {
                // Check for correct dd parameters to extract the hidden block
                if (cmd.includes("skip=2048") && cmd.includes("count=1000")) {
                    analysisOutput.innerHTML = `<span class="output">Extracted 1000 blocks (512000 bytes) from offset 2048</span>
<span class="output">Saved to part1.bin</span>
<span class="output">Analyzing extracted data...</span>
<span class="output">Found hidden block with marker: ##TAWON_HIDDEN_BLOCK##</span>
<span class="output">Decoding hidden message...</span>
<span class="important">CTF{dd_extract_hidden_block}</span>`;
                    
                    if (!flagsFound.includes('CTF{dd_extract_hidden_block}')) {
                        flagsFound.push('CTF{dd_extract_hidden_block}');
                        addTerminalLine('<span class="important">Flag 4: CTF{dd_extract_hidden_block}</span>');
                        showNotification('Hidden Block Extracted - Flag 4 Found');
                        updateProgress(20);
                    }
                } else {
                    analysisOutput.innerHTML = `<span class="output">Usage: dd if=firmware.img of=[output] bs=512 skip=[N] count=[M]</span>
<span class="output">Try different skip and count values to find hidden data blocks</span>`;
                    addTerminalLine('<span class="output">DD operation completed, but no significant data found with these parameters.</span>');
                }
            }, 1500);
        }
        
        function runObjdump(cmd) {
            addTerminalLine('<span class="output">Disassembling binary code with objdump...</span>');
            
            setTimeout(() => {
                asmOutput.innerHTML = `<span class="assembly-address">001000:</span>  <span class="assembly-opcode">e59f0010</span>  <span class="assembly-operands">ldr     r0, [pc, #16]</span>   <span class="assembly-comment">; 001018</span>
<span class="assembly-address">001004:</span>  <span class="assembly-opcode">e3a01000</span>  <span class="assembly-operands">mov     r1, #0</span>
<span class="assembly-address">001008:</span>  <span class="assembly-opcode">e5810000</span>  <span class="assembly-operands">str     r0, [r1]</span>
<span class="assembly-address">00100c:</span>  <span class="assembly-opcode">e59f1008</span>  <span class="assembly-operands">ldr     r1, [pc, #8]</span>   <span class="assembly-comment">; 00101c</span>
<span class="assembly-address">001010:</span>  <span class="assembly-opcode">e0810000</span>  <span class="assembly-operands">add     r0, r1, r0</span>
<span class="assembly-address">001014:</span>  <span class="assembly-opcode">e12fff10</span>  <span class="assembly-operands">bx      r0</span>
<span class="assembly-address">001018:</span>  <span class="assembly-opcode">deadbeef</span>  <span class="assembly-operands">.word   0xdeadbeef</span>
<span class="assembly-address">00101c:</span>  <span class="assembly-opcode">00010000</span>  <span class="assembly-operands">.word   0x00010000</span>

<span class="assembly-address">2abcd0:</span>  <span class="assembly-opcode">e3500000</span>  <span class="assembly-operands">cmp     r0, #0</span>
<span class="assembly-address">2abcd4:</span>  <span class="assembly-opcode">0a000004</span>  <span class="assembly-operands">beq     2abcec</span>  <span class="assembly-comment">; Normal execution path</span>
<span class="assembly-address">2abcd8:</span>  <span class="assembly-opcode">e59f0018</span>  <span class="assembly-operands">ldr     r0, [pc, #24]</span>  <span class="assembly-comment">; 2abcf8</span>
<span class="assembly-address">2abcdc:</span>  <span class="assembly-opcode">e12fff10</span>  <span class="assembly-operands">bx      r0</span>          <span class="assembly-comment">; This jump is conditionally skipped</span>
<span class="assembly-address">2abce0:</span>  <span class="assembly-opcode">e59f0014</span>  <span class="assembly-operands">ldr     r0, [pc, #20]</span>  <span class="assembly-comment">; 2abcfc</span>
<span class="assembly-address">2abce4:</span>  <span class="assembly-opcode">e5901000</span>  <span class="assembly-operands">ldr     r1, [r0]</span>
<span class="assembly-address">2abce8:</span>  <span class="assembly-opcode">e2811001</span>  <span class="assembly-operands">add     r1, r1, #1</span>
<span class="assembly-address">2abcec:</span>  <span class="assembly-opcode">e5801000</span>  <span class="assembly-operands">str     r1, [r0]</span>
<span class="assembly-address">2abcf0:</span>  <span class="assembly-opcode">e1a0f00e</span>  <span class="assembly-operands">mov     pc, lr</span>
<span class="assembly-address">2abcf4:</span>  <span class="assembly-opcode">00000000</span>  <span class="assembly-operands">.word   0x00000000</span>
<span class="assembly-address">2abcf8:</span>  <span class="assembly-opcode">00ff00ff</span>  <span class="assembly-operands">.word   0x00ff00ff</span>  <span class="assembly-comment">; Obfuscated jump destination</span>
<span class="assembly-address">2abcfc:</span>  <span class="assembly-opcode">00012345</span>  <span class="assembly-operands">.word   0x00012345</span>`;

                addTerminalLine('<span class="output">Disassembly complete. Found obfuscated code sections.</span>');
                
                // Check if they found the obfuscated jump
                if (cmd.includes("2abcd0") || cmd.includes("-D") || cmd.includes("--disassemble")) {
                    if (!flagsFound.includes('CTF{jump_opcode_obfuscated}')) {
                        flagsFound.push('CTF{jump_opcode_obfuscated}');
                        addTerminalLine('<span class="important">Flag 2: CTF{jump_opcode_obfuscated}</span>');
                        showNotification('Obfuscated Jump Found - Flag 2 Discovered');
                        updateProgress(20);
                    }
                }
            }, 2000);
        }
        
        function listFiles() {
            addTerminalLine('<span class="output">total 15728</span>');
            addTerminalLine('<span class="output">-rw-r--r-- 1 re re  15728640 Jan 15 04:12 firmware.img</span>');
            addTerminalLine('<span class="output">drwxr-xr-x 2 re re      4096 Jan 15 04:13 extracted/</span>');
            addTerminalLine('<span class="output">-rw-r--r-- 1 re re    512000 Jan 15 04:14 part1.bin</span>');
            addTerminalLine('<span class="output">drwxr-xr-x 8 re re      4096 Jan 15 04:15 squashfs-root/</span>');
            addTerminalLine('<span class="output">-rw-r--r-- 1 re re    104857 Jan 15 04:16 bootloader.bin</span>');
        }
        
        function showHelp() {
            addTerminalLine('<span class="output">Available reverse engineering commands:</span>');
            addTerminalLine('<span class="output">- binwalk firmware.img - Analyze firmware for embedded files</span>');
            addTerminalLine('<span class="output">- strings firmware.img - Extract printable strings</span>');
            addTerminalLine('<span class="output">- hexdump -C firmware.img - Hex dump of binary</span>');
            addTerminalLine('<span class="output">- dd if=firmware.img of=part1.bin bs=512 skip=2048 count=1000 - Extract binary section</span>');
            addTerminalLine('<span class="output">- objdump -D -m arm firmware.img - Disassemble binary</span>');
            addTerminalLine('<span class="output">- show flags - Display found flags</span>');
            addTerminalLine('<span class="output">- show progress - Display analysis progress</span>');
            addTerminalLine('<span class="output">- status - Show current analysis status</span>');
            addTerminalLine('<span class="output">- clear - Clear terminal</span>');
        }
        
        function showFlags() {
            if (flagsFound.length === 0) {
                addTerminalLine('<span class="output">No flags collected yet</span>');
            } else {
                addTerminalLine('<span class="output">Flags collected:</span>');
                flagsFound.forEach(flag => {
                    addTerminalLine(`<span class="important">- ${flag}</span>`);
                });
            }
        }
        
        function showProgress() {
            addTerminalLine(`<span class="output">Analysis progress: ${progress}%</span>`);
            addTerminalLine(`<span class="output">Flags collected: ${flagsFound.length}/5</span>`);
        }
        
        function showStatus() {
            addTerminalLine('<span class="output">Current analysis status:</span>');
            addTerminalLine('<span class="output">- Firmware structure: Partially analyzed</span>');
            addTerminalLine('<span class="output">- Embedded filesystem: Detected</span>');
            addTerminalLine('<span class="output">- Obfuscated code: Found</span>');
            addTerminalLine('<span class="output">- Hidden data blocks: Suspected</span>');
        }
        
        function clearTerminal() {
            terminal.innerHTML = '';
            addTerminalLine('<span class="prompt">re@embedded-system:~$</span> <span class="output">Terminal cleared</span>');
        }
        
        function addTerminalLine(content) {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = content;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function updateProgress(value) {
            progress += value;
            if (progress > 100) progress = 100;
            
            progressBar.style.width = progress + '%';
            progressText.textContent = `Analysis Progress: ${progress}%`;
            
            if (progress >= 80) {
                progressBar.style.background = 'linear-gradient(to right, var(--success), #00cc00)';
            }
            
            // Check if all flags are found
            if (flagsFound.length >= 5 && progress < 100) {
                progress = 100;
                progressBar.style.width = '100%';
                progressText.textContent = 'Analysis Progress: 100%';
                addTerminalLine('<span class="important">MISSION ACCOMPLISHED! All flags found and firmware analyzed!</span>');
                showNotification('Mission Accomplished! All Flags Collected!', true);
            }
        }
        
        function showNotification(message, isImportant = false) {
            notificationText.textContent = message;
            if (isImportant) {
                notification.style.borderColor = 'var(--warning)';
                notification.style.boxShadow = '0 0 20px rgba(255, 204, 0, 0.7)';
            } else {
                notification.style.borderColor = 'var(--primary)';
                notification.style.boxShadow = '0 0 20px rgba(126, 63, 242, 0.4)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            
            currentTab = tabId;
        }
        
        function selectFile(file) {
            addTerminalLine(`<span class="prompt">re@embedded-system:~$</span> <span class="command">select ${file}</span>`);
            
            switch(file) {
                case 'firmware.img':
                    addTerminalLine('<span class="output">Selected firmware.img as analysis target</span>');
                    break;
                    
                case 'extracted':
                    addTerminalLine('<span class="output">Opening extracted/ directory</span>');
                    addTerminalLine('<span class="output">Contents: squashfs-root/ binwalk.log extracted_bins/</span>');
                    break;
            }
        }
        
        function analyzeRegion(region) {
            if (region === 'bootloader') {
                addTerminalLine('<span class="prompt">re@embedded-system:~$</span> <span class="command">analyze bootloader</span>');
                addTerminalLine('<span class="output">Analyzing bootloader region...</span>');
                
                setTimeout(() => {
                    addTerminalLine('<span class="output">Found serial console initialization code</span>');
                    addTerminalLine('<span class="output">Password prompt detected at offset 0x2ABD38</span>');
                    addTerminalLine('<span class="output">Bootloader password: TawonMafiaSecureBoot2023</span>');
                    
                    if (!flagsFound.includes('CTF{bootloader_serial_password}')) {
                        flagsFound.push('CTF{bootloader_serial_password}');
                        addTerminalLine('<span class="important">Flag 5: CTF{bootloader_serial_password}</span>');
                        showNotification('Bootloader Password Found - Flag 5 Discovered');
                        updateProgress(20);
                        
                        // Mark region as scanned
                        document.querySelector('.memory-region:nth-child(1)').classList.add('scanned');
                    }
                }, 2000);
            } else {
                addTerminalLine('<span class="error">Region locked. Analyze bootloader first.</span>');
            }
        }
        
        function executeTool(tool) {
            addTerminalLine(`<span class="prompt">re@embedded-system:~$</span> <span class="command">${tool}</span>`);
            
            switch(tool) {
                case 'binwalk':
                    runBinwalk('binwalk firmware.img');
                    break;
                    
                case 'strings':
                    runStrings('strings firmware.img');
                    break;
                    
                case 'hexdump':
                    runHexdump('hexdump -C firmware.img | head -40');
                    break;
                    
                case 'dd':
                    analysisOutput.innerHTML = `<span class="output">DD extraction tool</span>
<span class="output">Usage: dd if=firmware.img of=output.bin bs=512 skip=N count=M</span>
<span class="output">Try skip=2048 count=1000 to extract a suspicious block</span>`;
                    break;
            }
        }
        
        function showHexDump(offset, length) {
            hexOutput.innerHTML = `<span class="output">Generating hex dump at offset ${offset.toString(16)}...</span>`;
            
            setTimeout(() => {
                // Generate a pseudo-random hex dump based on offset
                let hexContent = '';
                for (let i = 0; i < 10; i++) {
                    const address = offset + i * 16;
                    hexContent += `<span class="hex-address">${address.toString(16).padStart(6, '0')}:</span> `;
                    
                    // Generate random hex data
                    for (let j = 0; j < 16; j++) {
                        const byte = Math.floor(Math.random() * 256);
                        hexContent += `<span class="hex-data">${byte.toString(16).padStart(2, '0')} </span>`;
                    }
                    
                    hexContent += ' <span class="hex-ascii">';
                    // Generate random ASCII representation
                    for (let j = 0; j < 16; j++) {
                        const charCode = Math.floor(Math.random() * 256);
                        hexContent += (charCode > 31 && charCode < 127) 
                            ? String.fromCharCode(charCode) 
                            : '.';
                    }
                    hexContent += '</span>\n';
                }
                
                hexOutput.innerHTML = hexContent;
            }, 1000);
        }
        
        function disassembleRegion(offset, length) {
            asmOutput.innerHTML = `<span class="output">Disassembling code at offset ${offset.toString(16)}...</span>`;
            
            setTimeout(() => {
                // Generate pseudo-assembly based on offset
                let asmContent = '';
                for (let i = 0; i < length; i++) {
                    const address = offset + i * 4;
                    const opcode = Math.floor(Math.random() * 0xFFFFFFFF);
                    
                    asmContent += `<span class="assembly-address">${address.toString(16).padStart(6, '0')}:</span>  `;
                    asmContent += `<span class="assembly-opcode">${opcode.toString(16).padStart(8, '0')}</span>  `;
                    
                    // Simple disassembly based on opcode patterns
                    if (opcode % 5 === 0) {
                        asmContent += `<span class="assembly-operands">ldr     r${opcode % 4}, [pc, #${(opcode % 16) * 4}]</span>`;
                    } else if (opcode % 5 === 1) {
                        asmContent += `<span class="assembly-operands">str     r${opcode % 4}, [r${(opcode % 4) + 1}, #${opcode % 256}]</span>`;
                    } else if (opcode % 5 === 2) {
                        asmContent += `<span class="assembly-operands">add     r${opcode % 4}, r${(opcode % 4) + 1}, #${opcode % 128}</span>`;
                    } else if (opcode % 5 === 3) {
                        asmContent += `<span class="assembly-operands">b       ${(address + (opcode % 1024) - 512).toString(16)}</span>`;
                    } else {
                        asmContent += `<span class="assembly-operands">nop</span>`;
                    }
                    
                    asmContent += '\n';
                }
                
                asmOutput.innerHTML = asmContent;
            }, 1000);
        }
        
        function submitCompletion() {
            if (flagsFound.length >= 5) {
                addTerminalLine('<span class="success">Mission accomplished successfully!</span>');
                addTerminalLine('<span class="important">All flags found. Firmware reverse engineering complete!</span>');
                completionMessage.innerHTML = '<span class="success">✓ Mission accomplished! All 5 flags found!</span>';
                
                const townUrl = window.location.origin + "/town.html";
                // Redirect back to the town with completion parameter for Building 7
                window.location.href = `${townUrl}?completed=7`;
            } else {
                addTerminalLine('<span class="error">You haven\'t collected all flags yet!</span>');
                addTerminalLine(`<span class="output">Flags collected: ${flagsFound.length}/5 required</span>`);
                completionMessage.innerHTML = `<span class="error">✗ Only ${flagsFound.length}/5 flags collected. Keep analyzing!</span>`;
            }
        }
        
        function returnToTown() {
            sessionStorage.setItem('returningFromChallenge', 'true');
            const townUrl = window.location.origin + "/town.html";
            window.location.href = townUrl;
        }
        
        // Update countdown timer
        function updateCountdown() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            countdownElement.textContent = `TIME: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft > 0) {
                timeLeft--;
                setTimeout(updateCountdown, 1000);
            } else {
                addTerminalLine('<span class="error">TIME CRITICAL: Mission failed! Firmware self-destruct mechanism activated!</span>');
                showNotification('Mission Failed! Time expired!', true);
            }
        }
        
        // Initialize the interface
        window.onload = function() {
            commandInput.focus();
            updateCountdown();
        };
    </script>
</body>
</html>
