<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïµÔ∏è OSINT + Programming CTF</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Source+Code+Pro:wght@300;400;600&display=swap');
        
        :root {
            --main-bg: #0a0a12;
            --terminal-bg: #0a0a18;
            --terminal-border: #2a7fff;
            --terminal-glow: rgba(42, 127, 255, 0.5);
            --text-primary: #00ffcc;
            --text-secondary: #2a7fff;
            --text-command: #66ff00;
            --text-error: #ff2a7f;
            --text-success: #00ff95;
            --text-warning: #ffcc00;
            --text-info: #2a7fff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--main-bg);
            color: var(--text-primary);
            font-family: 'Source Code Pro', monospace;
            line-height: 1.6;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(42, 127, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 85% 30%, rgba(255, 42, 127, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 80%, rgba(42, 255, 127, 0.05) 0%, transparent 20%);
            min-height: 100vh;
            padding: 20px;
        }
        
        #app {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        
        #header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative;
            border-bottom: 1px solid var(--terminal-border);
            text-shadow: 0 0 10px var(--terminal-glow);
        }
        
        #header h1 {
            font-family: 'Share Tech Mono', monospace;
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        
        #header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        #terminal-container {
            position: relative;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 25px var(--terminal-glow);
        }
        
        #terminal-header {
            background: linear-gradient(90deg, #151530, #0f0f25);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--terminal-border);
            font-size: 0.9rem;
        }
        
        #terminal-controls {
            display: flex;
            gap: 8px;
        }
        
        .control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .control.close { background-color: #ff5f57; }
        .control.minimize { background-color: #ffbd2e; }
        .control.maximize { background-color: #28c940; }
        
        #terminal {
            background-color: var(--terminal-bg);
            height: 500px;
            padding: 20px;
            overflow-y: auto;
            background-image: 
                linear-gradient(rgba(10, 10, 24, 0.9), rgba(10, 10, 24, 0.9)),
                url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%232a7fff' fill-opacity='0.05' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
            border: 1px solid var(--terminal-border);
        }
        
        #input-container {
            display: flex;
            align-items: center;
            background-color: rgba(10, 10, 24, 0.7);
            padding: 10px 15px;
            border: 1px solid var(--terminal-border);
            border-radius: 8px;
            box-shadow: 0 0 15px var(--terminal-glow);
        }
        
        #prompt {
            color: var(--text-command);
            margin-right: 10px;
            font-weight: bold;
            text-shadow: 0 0 5px var(--text-command);
        }
        
        #command-input {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Source Code Pro', monospace;
            font-size: 1rem;
            outline: none;
            caret-color: var(--text-primary);
            text-shadow: 0 0 5px var(--text-primary);
        }
        
        #scoreboard {
            margin-top: 30px;
            padding: 20px;
            background: rgba(10, 10, 24, 0.7);
            border: 1px solid var(--terminal-border);
            border-radius: 8px;
            box-shadow: 0 0 15px var(--terminal-glow);
        }
        
        #scoreboard h3 {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        #flags-found {
            color: var(--text-success);
            margin-left: 10px;
            font-size: 1.5rem;
            text-shadow: 0 0 8px var(--text-success);
        }
        
        #scoreboard p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .command {
            color: var(--text-command);
            margin-bottom: 10px;
            text-shadow: 0 0 5px var(--text-command);
        }
        
        .output {
            margin-bottom: 15px;
            white-space: pre-wrap;
            text-shadow: 0 0 3px var(--text-primary);
        }
        
        .error {
            color: var(--text-error);
            text-shadow: 0 0 5px var(--text-error);
        }
        
        .success {
            color: var(--text-success);
            font-weight: bold;
            text-shadow: 0 0 8px var(--text-success);
        }
        
        .warning {
            color: var(--text-warning);
            text-shadow: 0 0 5px var(--text-warning);
        }
        
        .info {
            color: var(--text-info);
            text-shadow: 0 0 5px var(--text-info);
        }
        
        .directory {
            color: var(--text-secondary);
            text-shadow: 0 0 5px var(--text-secondary);
        }
        
        .file {
            color: var(--text-primary);
        }
        
        .executable {
            color: var(--text-command);
            text-shadow: 0 0 5px var(--text-command);
        }
        
        .scan-line {
            position: fixed;
            width: 100%;
            height: 10px;
            background: linear-gradient(to bottom, 
                rgba(0, 255, 204, 0.3), 
                rgba(0, 255, 204, 0.1), 
                rgba(0, 255, 204, 0.3));
            z-index: 5;
            animation: scan 4s linear infinite;
            pointer-events: none;
        }
        
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .hacking-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(42, 127, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 127, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: 1;
            pointer-events: none;
        }
        
        .glowing-particles {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 2;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-20px) translateX(10px); }
            50% { transform: translateY(-40px) translateX(0); }
            75% { transform: translateY(-20px) translateX(-10px); }
            100% { transform: translateY(0) translateX(0); }
        }
        
        #hud {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            display: none; /* Initially hidden */
        }
        
        .hud-item {
            background: rgba(10, 10, 24, 0.7);
            padding: 10px 15px;
            border: 1px solid var(--terminal-border);
            border-radius: 6px;
            box-shadow: 0 0 10px var(--terminal-glow);
            font-size: 0.9rem;
        }
        
        .hud-value {
            color: var(--text-success);
            font-weight: bold;
            text-shadow: 0 0 5px var(--text-success);
        }
        
        #matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
            pointer-events: none;
        }
        
        #submit-section {
            margin-top: 20px;
            text-align: center;
            display: block; /* Changed to always show */
        }
        
        #submit-button, #return-button {
            background: linear-gradient(135deg, #2a7fff, #7f2aff);
            color: white;
            border: none;
            padding: 12px 24px;
            font-family: 'Source Code Pro', monospace;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(42, 127, 255, 0.5);
        }
        
        #submit-button:hover, #return-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(42, 127, 255, 0.8);
        }
        
        #submit-button:disabled {
            background: linear-gradient(135deg, #555, #333);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        #submit-button.completed {
            background: linear-gradient(135deg, #00ff95, #00cc76);
            box-shadow: 0 0 15px rgba(0, 255, 149, 0.5);
        }
        
        @media (max-width: 768px) {
            #header h1 {
                font-size: 2rem;
            }
            
            #terminal {
                height: 400px;
                padding: 15px;
            }
            
            #hud {
                flex-direction: column;
                gap: 10px;
            }
            
            #submit-button, #return-button {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    <div class="hacking-grid"></div>
    <div class="glowing-particles" id="particles"></div>
    <canvas id="matrix-rain"></canvas>
    
    <div id="app">
        <div id="header">
            <h1>üïµÔ∏è OSINT + PROGRAMMING CTF</h1>
            <p>Investigate digital footprints and decode hidden messages to find all flags</p>
        </div>
        
        <div id="hud">
            <div class="hud-item">Case: <span class="hud-value">MYSTERY_PERSON</span></div>
            <div class="hud-item">Status: <span class="hud-value">INVESTIGATING</span></div>
            <div class="hud-item">Time: <span class="hud-value" id="timer">00:00:00</span></div>
        </div>
        
        <div id="terminal-container">
            <div id="terminal-header">
                <div>investigator@osint-box:~</div>
                <div id="terminal-controls">
                    <div class="control close"></div>
                    <div class="control minimize"></div>
                    <div class="control maximize"></div>
                </div>
            </div>
            <div id="terminal"></div>
        </div>
        
        <div id="input-container">
            <span id="prompt">investigator@osint-box:$</span>
            <input type="text" id="command-input" autofocus>
        </div>
        
        <div id="scoreboard">
            <h3>Flags Captured: <span id="flags-found">0</span>/5</h3>
            <p>Available commands: whois, nslookup, curl, strings, python, ls, cd, cat, help, clear</p>
        </div>
        
        <div id="submit-section">
            <p id="submit-message">Found all flags? Submit your completion!</p>
            <button id="submit-button" onclick="submitCompletion()">Submit Completion</button>
            <button id="return-button" onclick="returnToTown()">Return to Town</button>
        </div>
    </div>

    <script>
        // Game state
        const state = {
            currentPath: "/home/investigator",
            flagsFound: 0,
            startTime: new Date(),
            foundFlags: {
                flag1: false,
                flag2: false,
                flag3: false,
                flag4: false,
                flag5: false
            },
            downloadedFiles: {
                profileImage: false,
                obfuscatedMessage: false,
                decodeScript: false,
                prngScript: false
            },
            completed: false,
            prngSeed: Math.floor(Date.now() / 1000) - 180 // 3 minutes ago
        };

        // File system structure
        const fileSystem = {
            "/home/investigator": ["Downloads/", "Documents/", "Pictures/", "readme.txt"],
            "/home/investigator/Downloads": ["profile.jpg", "obfuscated_message.txt", "decode.py", "prng_challenge.py"],
            "/home/investigator/Documents": ["case_notes.txt", "clues/"],
            "/home/investigator/Documents/clues": ["twister_handle.txt", "domain_list.txt"],
            "/home/investigator/Pictures": ["screenshots/"]
        };

        // File contents
        const fileContents = {
            "/home/investigator/readme.txt": "OSINT Investigation Terminal\n\nYou are investigating 'MysteryPerson'\nUse available tools to gather information and find all flags",
            "/home/investigator/Documents/case_notes.txt": "Case Notes:\n- Target: MysteryPerson\n- Known handles: 0x1337Haxor\n- Suspected domain: mysteryperson.ctf\n- Possible social media: Twister",
            "/home/investigator/Documents/clues/twister_handle.txt": "Target's Twister handle: 0x1337Haxor",
            "/home/investigator/Documents/clues/domain_list.txt": "Domains to investigate:\n- mysteryperson.ctf\n- photos.mysteryperson.ctf"
        };

        // DOM elements
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const flagsFoundDisplay = document.getElementById('flags-found');
        const timerDisplay = document.getElementById('timer');
        const submitSection = document.getElementById('submit-section');
        const submitButton = document.getElementById('submit-button');
        const submitMessage = document.getElementById('submit-message');
        const hud = document.getElementById('hud');
        const promptElement = document.getElementById('prompt');

        // Update prompt to show current path
        function updatePrompt() {
            promptElement.textContent = `investigator@osint-box:${state.currentPath}$`;
        }

        // Initialize terminal
        printToTerminal('OSINT + Programming CTF Terminal - Type "help" for available commands\n\n', 'info');
        printToTerminal('Initializing investigation tools...', 'warning');
        setTimeout(() => {
            printToTerminal('Case file loaded: MYSTERY_PERSON', 'warning');
            setTimeout(() => {
                printToTerminal('Digital footprint analysis ready...\n', 'warning');
                printToTerminal('You are investigating a target known as "MysteryPerson"', 'success');
                printToTerminal('Find all 5 flags using OSINT techniques and code analysis.\n', 'success');
                printToTerminal('Start by examining the case files in your Documents folder.', 'info');
                
                // Show HUD after initialization
                hud.style.display = 'flex';
                
                // Update prompt
                updatePrompt();
                
                // Update submit button state
                updateSubmitButton();
            }, 800);
        }, 800);

        // Create glowing particles
        createParticles();

        // Start timer
        const timerInterval = setInterval(updateTimer, 1000);

        // Command processing
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                commandInput.value = '';
                
                if (command) {
                    printToTerminal(`investigator@osint-box:${state.currentPath}$ ${command}`, 'command');
                    processCommand(command);
                }
            }
        });

        function processCommand(command) {
            const parts = command.split(' ');
            const cmd = parts[0];
            const args = parts.slice(1);

            switch (cmd) {
                case 'ls':
                    executeLs(args);
                    break;
                case 'cd':
                    executeCd(args);
                    break;
                case 'cat':
                    executeCat(args);
                    break;
                case 'whois':
                    executeWhois(args);
                    break;
                case 'nslookup':
                    executeNslookup(args);
                    break;
                case 'curl':
                    executeCurl(args);
                    break;
                case 'strings':
                    executeStrings(args);
                    break;
                case 'python':
                    executePython(args);
                    break;
                case 'help':
                    executeHelp();
                    break;
                case 'clear':
                    terminal.innerHTML = '';
                    break;
                default:
                    printToTerminal(`Command not found: ${cmd}`, 'error');
            }
        }

        function executeLs(args) {
            const path = args[0] ? resolvePath(args[0]) : state.currentPath;
            
            if (!fileSystem[path]) {
                printToTerminal(`ls: cannot access '${args[0] || path}': No such file or directory`, 'error');
                return;
            }
            
            const items = fileSystem[path];
            let output = '';
            
            items.forEach(item => {
                if (item.endsWith('/')) {
                    output += `<span class="directory">${item}</span> `;
                } else if (item.endsWith('.py') || item.endsWith('.exe')) {
                    output += `<span class="executable">${item}</span> `;
                } else {
                    output += `<span class="file">${item}</span> `;
                }
            });
            
            printToTerminal(output, '', true);
        }

        function executeCd(args) {
            if (!args[0]) {
                state.currentPath = "/home/investigator";
                updatePrompt();
                return;
            }

            let targetPath = resolvePath(args[0]);
            
            // Special case for parent directory
            if (args[0] === '..') {
                if (state.currentPath === '/home/investigator') {
                    printToTerminal('Cannot go above home directory', 'warning');
                    return;
                }
                
                const parts = state.currentPath.split('/').filter(p => p);
                parts.pop();
                state.currentPath = parts.length ? '/' + parts.join('/') : '/home/investigator';
                updatePrompt();
                return;
            }
            
            // Check if directory exists
            if (!fileSystem[targetPath] && !fileSystem[targetPath + '/']) {
                printToTerminal(`cd: no such file or directory: ${args[0]}`, 'error');
                return;
            }
            
            // Add trailing slash if needed
            if (!targetPath.endsWith('/')) {
                targetPath += '/';
            }
            
            state.currentPath = targetPath;
            updatePrompt();
        }

        function executeCat(args) {
            if (!args[0]) {
                printToTerminal('Usage: cat FILE', 'error');
                return;
            }

            const filePath = resolvePath(args[0]);
            
            if (filePath in fileContents) {
                printToTerminal(fileContents[filePath]);
            } else {
                printToTerminal(`cat: ${args[0]}: No such file or directory`, 'error');
            }
        }

        function executeWhois(args) {
            if (args.length === 0) {
                printToTerminal('Usage: whois DOMAIN', 'error');
                return;
            }

            const domain = args[0];
            
            if (domain === 'mysteryperson.ctf') {
                printToTerminal('Domain Name: MYSTERYPERSON.CTF');
                printToTerminal('Registry Domain ID: D0M4IN_1337');
                printToTerminal('Registrar WHOIS Server: whois.ctfregistry.ctf');
                printToTerminal('Registrar URL: http://registry.ctf');
                printToTerminal('Updated Date: 2024-01-15T10:30:00Z');
                printToTerminal('Creation Date: 2023-05-20T14:22:31Z');
                printToTerminal('Registry Expiry Date: 2025-05-20T14:22:31Z');
                printToTerminal('Registrar: CTF Registry Inc.');
                printToTerminal('Registrar IANA ID: 9999');
                printToTerminal('Registrant Name: John Doe');
                printToTerminal('Registrant Organization: N/A');
                printToTerminal('Registrant Street: 123 Hacker Way');
                printToTerminal('Registrant City: Cyber City');
                printToTerminal('Registrant State/Province: Digital State');
                printToTerminal('Registrant Postal Code: 13337');
                printToTerminal('Registrant Country: CT');
                printToTerminal('Registrant Phone: +1.55501231337');
                printToTerminal('Registrant Email: jdoe1337@protonmail.ctf');
                printToTerminal('Registrant Fax: +1.55501231338');
                printToTerminal('FLAG{whois_doxxed}');
                
                // Check for flag
                checkForFlags('FLAG{whois_doxxed}', 1);
            } else {
                printToTerminal(`whois: ${domain}: not found`, 'error');
            }
        }

        function executeNslookup(args) {
            if (args.length === 0) {
                printToTerminal('Usage: nslookup DOMAIN', 'error');
                return;
            }

            const domain = args[0];
            
            if (domain === 'photos.mysteryperson.ctf') {
                printToTerminal('Server:		127.0.0.53');
                printToTerminal('Address:	127.0.0.53#53');
                printToTerminal('');
                printToTerminal('Non-authoritative answer:');
                printToTerminal('photos.mysteryperson.ctf	canonical name = admin-panel.ctf.private.');
                printToTerminal('Name:	admin-panel.ctf.private');
                printToTerminal('Address: 10.13.37.42');
                printToTerminal('');
                printToTerminal('FLAG{dns_exposed_internal}');
                
                // Check for flag
                checkForFlags('FLAG{dns_exposed_internal}', 2);
            } else {
                printToTerminal(`nslookup: cannot resolve ${domain}: SERVFAIL`, 'error');
            }
        }

        function executeCurl(args) {
            if (args.length === 0) {
                printToTerminal('curl: try \'curl --help\' or \'curl --manual\' for more information', 'error');
                return;
            }

            const url = args[0];
            
            // Simulate web server responses
            if (url === 'https://twister.com/u/0x1337Haxor') {
                printToTerminal('<!DOCTYPE html>');
                printToTerminal('<html>');
                printToTerminal('<head><title>0x1337Haxor - Twister</title></head>');
                printToTerminal('<body>');
                printToTerminal('<h1>0x1337Haxor</h1>');
                printToTerminal('<p>Security researcher & CTF enthusiast</p>');
                printToTerminal('<img src="/media/profile.jpg" alt="Profile picture">');
                printToTerminal('<div class="tweets">');
                printToTerminal('<div class="tweet">Just set up my new server! #infrastructure</div>');
                printToTerminal('<div class="tweet">Working on a new crypto challenge for CTF</div>');
                printToTerminal('</div>');
                printToTerminal('</body>');
                printToTerminal('</html>');
                
                // Download the profile image
                if (!state.downloadedFiles.profileImage) {
                    printToTerminal('\nDownloading profile image...', 'info');
                    setTimeout(() => {
                        printToTerminal('Profile image saved to Downloads folder', 'success');
                        state.downloadedFiles.profileImage = true;
                    }, 1000);
                }
            }
            else if (url === 'https://paste.ctf/p/obfuscated_message.txt') {
                printToTerminal('7e796a6b60677d6b7a78667d6b7c796a6b7d6b60677d686b64647d6b7e796a6b60677d6b7a78667d6b7c796a6b7d6b60677d686b6464');
                printToTerminal('\nThis message appears to be obfuscated with multiple encoding techniques.');
                
                // Download the message
                if (!state.downloadedFiles.obfuscatedMessage) {
                    printToTerminal('\nDownloading obfuscated message...', 'info');
                    setTimeout(() => {
                        printToTerminal('Obfuscated message saved to Downloads folder', 'success');
                        state.downloadedFiles.obfuscatedMessage = true;
                    }, 1000);
                }
            }
            else if (url === 'https://paste.ctf/p/decode.py') {
                printToTerminal('import base64');
                printToTerminal('');
                printToTerminal('def decode_message(encoded):');
                printToTerminal('    # First, convert hex to bytes');
                printToTerminal('    bytes_data = bytes.fromhex(encoded)');
                printToTerminal('    ');
                printToTerminal('    # Then apply Caesar cipher (shift 3)');
                printToTerminal('    decoded = ""');
                printToTerminal('    for byte in bytes_data:');
                printToTerminal('        decoded += chr(byte - 3)');
                printToTerminal('    ');
                printToTerminal('    # Finally, base64 decode');
                printToTerminal('    return base64.b64decode(decoded).decode()');
                printToTerminal('');
                printToTerminal('# FLAG{decoded_the_mess}');
                
                // Download the decode script
                if (!state.downloadedFiles.decodeScript) {
                    printToTerminal('\nDownloading decode script...', 'info');
                    setTimeout(() => {
                        printToTerminal('Decode script saved to Downloads folder', 'success');
                        state.downloadedFiles.decodeScript = true;
                    }, 1000);
                }
            }
            else if (url === 'https://paste.ctf/p/prng_challenge.py') {
                printToTerminal('import time');
                printToTerminal('import random');
                printToTerminal('');
                printToTerminal('# Generate a random number based on current time');
                printToTerminal('def generate_random():');
                printToTerminal('    seed = int(time.time())');
                printToTerminal('    random.seed(seed)');
                printToTerminal('    return random.randint(0, 1000000)');
                printToTerminal('');
                printToTerminal('# Current value: 478231');
                printToTerminal('# FLAG{timing_attack_success}');
                
                // Download the PRNG script
                if (!state.downloadedFiles.prngScript) {
                    printToTerminal('\nDownloading PRNG challenge...', 'info');
                    setTimeout(() => {
                        printToTerminal('PRNG challenge saved to Downloads folder', 'success');
                        state.downloadedFiles.prngScript = true;
                    }, 1000);
                }
            }
            else {
                printToTerminal(`curl: (7) Failed to connect to host: Connection refused`, 'error');
            }
        }

        function executeStrings(args) {
            if (args.length === 0) {
                printToTerminal('Usage: strings FILE', 'error');
                return;
            }

            const file = args[0];
            
            if (file === 'profile.jpg' && state.downloadedFiles.profileImage) {
                printToTerminal('JFIF');
                printToTerminal('Exif');
                printToTerminal('Created with GIMP');
                printToTerminal('Copyright MysteryPerson 2024');
                printToTerminal('FLAG{meta_is_gold}');
                printToTerminal('... (other binary data)');
                
                // Check for flag
                checkForFlags('FLAG{meta_is_gold}', 3);
            } else {
                printToTerminal(`strings: '${file}': No such file`, 'error');
            }
        }

        function executePython(args) {
            if (args.length === 0) {
                printToTerminal('Python 3.10.12 (main, Jun 11 2023, 05:26:28)');
                printToTerminal('[GCC 11.4.0] on linux');
                printToTerminal('Type "help", "copyright", "credits" or "license" for more information.');
                printToTerminal('>>>');
                return;
            }

            if (args[0] === 'decode.py' && args[1] === 'obfuscated_message.txt') {
                if (!state.downloadedFiles.decodeScript || !state.downloadedFiles.obfuscatedMessage) {
                    printToTerminal('Python can\'t find the required files', 'error');
                    return;
                }
                
                printToTerminal('Running decode script...');
                
                // Simulate the decoding process
                setTimeout(() => {
                    printToTerminal('Hex decoded: ~yjk`g}kzxf}k|yjk}`k`g}hkdd}');
                    printToTerminal('Caesar decoded: Vvgh]hdwcu]h_vgh]a_hwdd[');
                    printToTerminal('Base64 decoded: FLAG{decoded_the_mess}');
                    
                    // Check for flag
                    checkForFlags('FLAG{decoded_the_mess}', 4);
                }, 1000);
            }
            else if (args[0] === 'prng_challenge.py') {
                if (!state.downloadedFiles.prngScript) {
                    printToTerminal('Python can\'t find the required file', 'error');
                    return;
                }
                
                printToTerminal('Running PRNG challenge...');
                printToTerminal('Brute forcing seed based on time...');
                
                // Simulate the brute force process
                setTimeout(() => {
                    printToTerminal('Trying seeds around current time...');
                    printToTerminal(`Found matching output with seed: ${state.prngSeed}`);
                    printToTerminal('FLAG{timing_attack_success}');
                    
                    // Check for flag
                    checkForFlags('FLAG{timing_attack_success}', 5);
                }, 1500);
            }
            else {
                printToTerminal(`python: can't open file '${args[0]}': [Errno 2] No such file or directory`, 'error');
            }
        }

        function executeHelp() {
            const helpText = `Available commands:
ls [DIR]        - List directory contents
cd [DIR]        - Change directory
cat FILE        - Display file contents
whois DOMAIN    - Query domain registration info
nslookup DOMAIN - Query DNS records
curl URL        - Transfer data from a server
strings FILE    - Extract text from binary file
python FILE     - Run Python script
help            - Display this help
clear           - Clear the terminal

Flags:
There are 5 flags to find using OSINT and programming skills:
1. WHOIS data investigation
2. DNS information leakage
3. Metadata extraction
4. Message deobfuscation
5. PRNG timing attack
`;
            printToTerminal(helpText);
        }

        function resolvePath(path) {
            if (path.startsWith('/')) {
                return path;
            }
            
            // Handle relative paths
            if (path === '..') {
                const parts = state.currentPath.split('/').filter(p => p);
                parts.pop();
                return parts.length ? '/' + parts.join('/') : '/home/investigator';
            }
            
            // Handle subdirectories
            if (state.currentPath.endsWith('/')) {
                return state.currentPath + path;
            } else {
                return state.currentPath + '/' + path;
            }
        }

        function checkForFlags(flag, flagNumber) {
            if (!state.foundFlags[`flag${flagNumber}`]) {
                state.foundFlags[`flag${flagNumber}`] = true;
                state.flagsFound++;
                flagsFoundDisplay.textContent = state.flagsFound;
                printToTerminal(`\nFlag ${flagNumber} captured: ${flag}`, 'success');
                
                if (state.flagsFound === 5 && !state.completed) {
                    state.completed = true;
                    state.endTime = new Date();
                    const timeTaken = Math.floor((state.endTime - state.startTime) / 1000);
                    const minutes = Math.floor(timeTaken / 60);
                    const seconds = timeTaken % 60;
                    
                    printToTerminal(`\nüéâ INVESTIGATION COMPLETE! üéâ\nCaptured all 5 flags in ${minutes}m ${seconds}s!`, 'success');
                    printToTerminal('You have proven yourself as a skilled digital investigator!', 'success');
                    
                    // Update submit button
                    updateSubmitButton();
                    terminal.scrollTop = terminal.scrollHeight;
                }
                
                // Update submit button after each flag found
                updateSubmitButton();
            }
        }

        function updateSubmitButton() {
            if (state.completed) {
                submitButton.disabled = false;
                submitButton.classList.add('completed');
                submitButton.textContent = "Submit Completion";
                submitMessage.textContent = "Congratulations! You found all flags! Submit your completion.";
            } else {
                submitButton.disabled = true;
                submitButton.classList.remove('completed');
                submitButton.textContent = `Submit (${state.flagsFound}/5 flags)`;
                submitMessage.textContent = `Found ${state.flagsFound} of 5 flags. Find all to submit completion.`;
            }
        }

        function printToTerminal(text, className = '', isHTML = false) {
            const div = document.createElement('div');
            if (className) {
                div.className = `output ${className}`;
            } else {
                div.className = 'output';
            }
            
            if (isHTML) {
                div.innerHTML = text;
            } else {
                div.textContent = text;
            }
            
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const colors = ['#2a7fff', '#00ffcc', '#7f2aff', '#ff2a7f'];
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random properties
                const size = Math.random() * 10 + 5;
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.background = color;
                particle.style.boxShadow = `0 0 ${size*2}px ${size}px ${color}`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
                particle.style.animationDelay = `-${Math.random() * 20}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        function updateTimer() {
            const now = new Date();
            const elapsed = Math.floor((now - state.startTime) / 1000);
            
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Matrix rain effect
        function setupMatrixRain() {
            const canvas = document.getElementById('matrix-rain');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to match window
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const characters = '01';
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            
            // Create an array for drops - one per column
            const drops = [];
            for (let i = 0; i < columns; i++) {
                drops[i] = Math.floor(Math.random() * canvas.height / fontSize);
            }
            
            function draw() {
                // Semi-transparent black to create trail effect
                ctx.fillStyle = 'rgba(10, 10, 24, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#00ffcc';
                ctx.font = `${fontSize}px monospace`;
                
                for (let i = 0; i < drops.length; i++) {
                    const text = characters.charAt(Math.floor(Math.random() * characters.length));
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    // Reset drop to top of screen randomly or if it reaches bottom
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    
                    drops[i]++;
                }
            }
            
            // Start the animation
            setInterval(draw, 33);
        }
        
        // Submit completion function
        function submitCompletion() {
            if (state.flagsFound === 5) {
                // Get the town page URL from the current domain
                const townUrl = window.location.origin + "/town.html";
                // Redirect back to the town with completion parameter for this challenge
                window.location.href = `${townUrl}?completed=2`;
            } else {
                alert("You haven't found all flags yet! Keep investigating.");
            }
        }

        // Return to town function
        function returnToTown() {
            // Set a flag indicating we're returning from a challenge
            sessionStorage.setItem('returningFromChallenge', 'true');
            const townUrl = window.location.origin + "/town.html";
            window.location.href = townUrl;
        }

        // Initialize matrix rain
        window.addEventListener('load', function() {
            setupMatrixRain();
            updatePrompt();
        });
        window.addEventListener('resize', setupMatrixRain);
    </script>
</body>
</html>
